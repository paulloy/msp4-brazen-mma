{% extends 'base.html' %}
{% load static %}

{% block meta_description %}
    <meta name="Description" content="This is the product page for {{ product.name }}"/>
{% endblock %}

{% block title %}
 - Products | {{ product.name }}
{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/products.css' %}">
{% endblock %}

{% block content %}

<!-- breadcrumbs ------------------------------------------------------------------------------------------->
<div id="breadcrumbs" class="mx-auto header">
    <nav aria-label="breadcrumb" class="col-12 h-100 d-flex align-items-center py-lg-0 px-lg-5 px-2">
        <ol class="breadcrumb d-flex flex-column p-0 m-0 w-100">
            <span class="d-flex justify-content-center">
                <li class="breadcrumb-item"><a href="{% url 'products' %}?category={{ product.category }}">{{ product.category }}</a></li>
                <li class="breadcrumb-item" aria-current="page"><a href="{% url 'products' %}?category={{ product.category }}&product_type={{ product.product_type }}">{{ product.product_type }}</a></li> 
            </span>                 
            <li class="mx-auto breadcrumb-item active m-0" aria-current="page">/ {{ product.name }}</li>                  
        </ol>
    </nav>
</div>
<!---------------------------------------------------------------------------------------------------------->

<!-- product management ----------------------------------------------------------------------------------->
{% if request.user.is_superuser %}
    <div id="product-management" class="p-3 mx-auto">
        <h4 class="text-center pb-3">Product Management</h4>
        <div id="update-delete-product">
            <div class="d-flex justify-content-center p-3">
                <a class="mx-3 button-width btn btn-primary" href="{% url 'edit_product' product.product_id %}">Update Product</a>
                <button id="confirm-delete" class="mx-3 button-width btn btn-danger">Delete Product</button>
            </div>
        </div>
        <div id="delete-product">
            <div class="d-flex flex-column p-3 justify-content-center">
                <h6 class="w-100 text-center">Are you sure you want to delete this product?</h6>
                <div class="d-flex p-3 justify-content-center">
                    <button id="cancel-delete" class="mx-3 button-width btn btn-secondary">Cancel</button>
                    <a class="mx-3 button-width btn btn-danger" href="{% url 'delete_product' product.product_id %}">Confirm Delete</a>
                </div>
            </div>
        </div>
    </div>
{% endif %}
<!--------------------------------------------------------------------------------------------------------->

<!-- product container --------------------------------------------------------------------------------------------------------------------------------------------------->

<div id="product-display" class="d-flex mx-auto p-3">        
    <!-- product image -->
    <div class="mx-auto product-img-container p-0 d-block">
        <img src="{% url 'home' %}media/{{ product.image }}" alt="{{ product.name }}">
    </div>
    <!-- product details -->
    <div id="product-details" class="p-3 mx-auto"> 
        <div>   
            <!-- product name -->
            <h5 class="text-center bg-white p-3"><strong>{{ product.name }}</strong></h5>                      
            <!-- product price -->  
        {% if product.sale %}
            <p class="text-center p-2 bg-white bold mt-3"><span class="mr-3 text-danger">£{{ product.price }} <i class="fas fa-tags"></i></span> <span class="mr-1 text-muted" title="Recommended Retail Price">RRP:</span><strike class="p-0 text-muted">£{{ product.rrp }}</strike></p>    
        {% else %}
            <p class="p-2 mt-3 bold bg-white text-center price">£{{ product.price }}</p>
        {% endif %}
            <!-- product description -->
            <div class="d-flex mt-3 bg-white p-3 flex-column">
                <strong class="text-center w-100">Product Description</strong>
                <p class="text-justify m-0 mt-2">{{ product.description }}</p>
            </div>
        </div> 
        <div id="cart-size" class="d-flex bg-white flex-column mt-3 p-3">
            {% if sizes.count > 1 %}
                <div>
                    <p class="w-100"><span class="bold">SIZES</span> <a class="float-right" href="#">see size chart</a></p>
                    <div class="d-flex flex-wrap justify-content-center">
                        {% if sizes.count > 1 %}
                            {% for x in sizes %}
                                {% if x.stock < 1 %}
                                    <p class="btn btn-danger out-of-stock size"><strong>{{ x.size }}</strong></p>
                                {% elif x.stock < 5 %}                                    
                                    <p class="btn btn-warning size"><strong>{{ x.size }}</strong></p>
                                {% else %}
                                    <p class="btn btn-primary size"><strong>{{ x.size }}</strong></p>
                                {% endif %}
                                {% if forloop.counter >= sizes.count %}
                                    <div class="d-flex justify-content-center w-100 m-0 w-100">
                                        {% if low_stock == True %}
                                            <span class="my-1 mx-2"><i class="fas fa-circle text-warning"></i> low stock!</span>
                                        {% endif %}
                                        {% if no_stock == True %}
                                            <span class="my-1 mx-2"><i class="fas fa-circle text-danger"></i> out of stock</span>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            {% endfor %}
                            <p id="please-select-size" class="text-danger bold m-0 mt-3">Please select a size.</p>
                        {% endif %}
                    </div>
                </div>
            {% endif %}                       
        </div>                
        <!-- product sizes -->            
        <form id="add-to-bag-form" method="POST" action="{% url 'add_to_bag' product.product_id %}"
        class="d-flex bg-white mx-auto flex-column justify-content-between">
            {% csrf_token %}
            <label for="quantity" class="mx-auto bold my-0">QUANTITY</label>
            <div class="my-3 mx-auto d-flex align-items-center">
                <button id="quantity-sub" class="btn btn-primary quantity-selector" type="button"><i class="fas fa-chevron-left"></i></button>
                <input id="quantity" name="quantity" type="number" min="1" max="99" value="1" class="text-center" required>
                <button id="quantity-add" class="btn btn-primary quantity-selector" type="button"><i class="fas fa-chevron-right"></i></button>
                <input type="hidden" name="redirect_url" value="{{ request.path }}">
                <input id="size_input" type="hidden" name="size" value="false">                    
            </div>
            <div class="px-3">
                <button id="add-to-bag-submit" type="submit" class="my-3 btn btn-primary w-100">Add to bag <i class="fas fa-shopping-bag"></i></button>
            </div>
        </form>       
    </div>
</div>

<!------------------------------------------------------------------------------------------------------------------------------------------------------------------------>

{% endblock %}

{% block js %}
    <script src="{% static 'js/products.js' %}"></script>
{% endblock %}